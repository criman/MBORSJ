# 单元测试说明

本文档说明如何在 PC 上使用 gcc 编译和运行各模块的单元测试。

## 测试模块列表

1. **旁通阀 (ByPassValve)** - TEST_MODULE=1
2. **补水阀 (WaterFeedValve)** - TEST_MODULE=2
3. **循环泵 (CirculationPump)** - TEST_MODULE=3
4. **压缩机 (Comp)** - TEST_MODULE=4
5. **外风机 (Fan)** - TEST_MODULE=5
6. **电子膨胀阀 (Stepmotor)** - TEST_MODULE=6

## 编译命令

### 旁通阀测试
```powershell
gcc -o ByPassValve_test `
    code/Function/ByPassValve_test.c `
    code/Function/ByPassValve.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=1 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc
```

### 补水阀测试
```powershell
gcc -o WaterFeedValve_test `
    code/Function/WaterFeedValve_test.c `
    code/Function/WaterFeedValve.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=2 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc
```

### 循环泵测试
```powershell
gcc -o CirculationPump_test `
    code/Function/CirculationPump_test.c `
    code/Function/CirculationPump.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=3 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc
```

### 压缩机测试
```powershell
gcc -o Comp_test `
    code/Function/Comp_test.c `
    code/Function/Comp.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=4 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc
```

### 外风机测试
```powershell
gcc -o Fan_test `
    code/Function/Fan_test.c `
    code/Function/Fan.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=5 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc
```

### 电子膨胀阀测试
```powershell
gcc -o Stepmotor_test `
    code/Function/Stepmotor_test.c `
    code/Module/Module_Stepmotor_V1.0.0/Stepmotor_app.c `
    code/_msys/main.c `
    -DUNIT_TEST -DTEST_MODULE=6 `
    -I. -Icode/_msys -Icode/Function -Icode/_CMSIS -Icode/_mdev `
    -Ilibrary/Device/ES8H018x/Include -Ilibrary/StdDriver/inc `
    -Icode/Module/Module_Stepmotor_V1.0.0
```

## 运行测试

编译成功后，在项目根目录运行：

```powershell
.\ByPassValve_test.exe
.\WaterFeedValve_test.exe
.\CirculationPump_test.exe
.\Comp_test.exe
.\Fan_test.exe
.\Stepmotor_test.exe
```

## 注意事项

1. **编译环境**：需要安装 MinGW 或 MSYS2，确保 `gcc` 命令可用。
2. **依赖关系**：某些测试可能需要额外的源文件，如果遇到链接错误，请根据错误信息添加相应的源文件。
3. **测试覆盖**：当前测试用例覆盖了核心功能逻辑，可根据实际需求扩展更多测试场景。
4. **正常程序运行**：单元测试不会影响 Keil 编译和芯片上的正常运行，因为使用了条件编译 `#if defined(__GNUC__) && defined(UNIT_TEST)`。

## 测试结果

每个测试程序会输出：
- 测试用例执行情况（PASS/FAIL）
- 总计、通过、失败的测试数量
- 返回码：0 表示全部通过，1 表示有失败

